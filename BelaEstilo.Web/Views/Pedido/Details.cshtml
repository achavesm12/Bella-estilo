@model BelaEstilo.Application.DTOs.PedidoDTO

@{
    ViewData["Title"] = "Factura";
}

<div class="container my-5" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
    <div class="card shadow p-4" style="border-radius: 10px; border: 1px solid #dee2e6;">
        <h2 class="text-center mb-4" style="color: #c2185b; font-weight: 700; letter-spacing: 1.5px;">Factura Comercial</h2>

        <!-- Encabezado del Pedido -->
        <section class="mb-4 border-bottom pb-3" style="border-color: #f8bbd0 !important;">
            <h4 style="color: #880e4f;">Encabezado del Pedido</h4>
            <dl class="row">
                <dt class="col-sm-4 font-weight-bold">Número de Pedido:</dt>
                <dd class="col-sm-8" style="color: #4a148c;">@Model.IdPedido</dd>

                <dt class="col-sm-4 font-weight-bold">Fecha y Hora de Emisión:</dt>
                <dd class="col-sm-8" style="color: #4a148c;">@Model.FechaPedido.ToString("dd/MM/yyyy HH:mm:ss")</dd>
            </dl>
        </section>

        <!-- Información del Cliente -->
        <section class="mb-4 border-bottom pb-3" style="border-color: #f8bbd0 !important;">
            <h4 style="color: #880e4f;">Información del Cliente</h4>
            <dl class="row">
                <dt class="col-sm-4 font-weight-bold">Nombre del Cliente:</dt>
                <dd class="col-sm-8" style="color: #4a148c;">@Model.IdUsuarioNavigation?.Nombre</dd>

                <dt class="col-sm-4 font-weight-bold">Dirección de Envío:</dt>
                <dd class="col-sm-8 text-muted">
                    @if (!string.IsNullOrWhiteSpace(Model.DireccionEnvio))
                    {
                        <span style="color:#6a1b9a;">@Model.DireccionEnvio</span>
                    }
                    else
                    {
                        <em>No registrada</em>
                    }
                </dd>
            </dl>
        </section>

        <!-- Método de Pago -->
        <section class="mb-4 border-bottom pb-3" style="border-color: #f8bbd0 !important;">
            <h4 style="color: #880e4f;">Método de Pago</h4>
            <dl class="row">
                <dt class="col-sm-4 font-weight-bold">Forma de Pago:</dt>
                <dd class="col-sm-8" style="color: #4a148c;">
                    @if (!string.IsNullOrWhiteSpace(Model.MetodoPago))
                    {
                        @Model.MetodoPago
                    }
                    else
                    {
                        <em>No especificado</em>
                    }
                </dd>
            </dl>
        </section>

        <!-- Detalle de Productos -->
        <section class="mb-4 border-bottom pb-3" style="border-color: #f8bbd0 !important;">
            <h4 style="color: #880e4f;">Detalle de Productos</h4>

            @if (Model.PedidoProducto != null && Model.PedidoProducto.Any())
            {
                <table class="table table-bordered">
                    <thead class="table-light" style="background-color: #fce4ec;">
                        <tr>
                            <th>Nombre del Producto</th>
                            <th>Cantidad</th>
                            <th>Precio Unitario</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.PedidoProducto)
                        {
                            <tr>
                                <td>@item.IdProductoNavigation?.Nombre</td>
                                <td>@item.Cantidad</td>
                                <td style="color:#ad1457;">₡@item.PrecioUnitario.ToString("N2")</td>
                                <td style="font-weight: 600; color: #2e7d32;">₡@((item.Cantidad * item.PrecioUnitario).ToString("N2"))</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted">No hay productos asociados a este pedido.</p>
            }
        </section>

        <!-- Detalle de Productos Personalizados -->
        <section class="mb-4 border-bottom pb-3" style="border-color: #f8bbd0 !important;">
            <h4 style="color: #880e4f;">Detalle de Productos Personalizados</h4>

            @if (Model.PedidoPersonalizado != null && Model.PedidoPersonalizado.Any())
            {
                foreach (var personalizado in Model.PedidoPersonalizado)
                {
                    <div class="mb-3 p-3" style="background-color: #fce4ec; border-radius: 8px;">
                        <h5>@personalizado.NombreProductoPersonalizado</h5>
                        <p><strong>Costo Base:</strong> ₡@personalizado.CostoBase.ToString("N2")</p>

                        @if (personalizado.Criterios != null && personalizado.Criterios.Any())
                        {
                            <table class="table table-sm table-bordered" style="background-color: white;">
                                <thead>
                                    <tr>
                                        <th>Criterio</th>
                                        <th>Opción Seleccionada</th>
                                        <th>Costo Extra</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var criterio in personalizado.Criterios)
                                    {
                                        <tr>
                                            <td>@criterio.NombreCriterio</td>
                                            <td>@criterio.OpcionSeleccionada</td>
                                            <td>₡@criterio.CostoExtra.ToString("N2")</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        }
                        else
                        {
                            <p class="text-muted"><em>No hay criterios personalizados para este producto.</em></p>
                        }

                        <p><strong>Total Producto Personalizado:</strong> ₡@personalizado.TotalProductoPersonalizado.ToString("N2")</p>
                    </div>
                }
            }
            else
            {
                <p class="text-muted"><em>No hay productos personalizados registrados para este pedido.</em></p>
            }
        </section>

        <!-- Resumen del Pedido -->
        @{
            decimal subtotal = Model.Subtotal;
            decimal impuesto = Model.IVA;
            decimal total = Model.Total ?? 0m;
        }

        <section class="mb-4">
            <h4 style="color: #880e4f;">Resumen del Pedido</h4>
            <dl class="row">
                <dt class="col-sm-4 font-weight-bold">Subtotal:</dt>
                <dd class="col-sm-8" style="color: #2e7d32;">₡@subtotal.ToString("N2")</dd>

                <dt class="col-sm-4 font-weight-bold">Impuestos (13%):</dt>
                <dd class="col-sm-8" style="color: #2e7d32;">₡@impuesto.ToString("N2")</dd>

                <dt class="col-sm-4 font-weight-bold">Total del Pedido:</dt>
                <dd class="col-sm-8 font-weight-bold text-success" style="font-size: 1.25rem;">₡@total.ToString("N2")</dd>
            </dl>
        </section>
    </div>
</div>

<div class="mt-4">
    <a asp-action="Index" class="btn" style="background-color: #c2185b; color: white;">
        ← Volver a la lista de pedidos
    </a>
</div>
